name: CI

on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]


jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Verify addon folder exists
        run: |
          test -d "WeatherBeatenJournal" || (echo "Expected ./WeatherBeatenJournal addon folder not found" && exit 1)
          test -f "WeatherBeatenJournal/WeatherBeatenJournal.toc" || (echo "Expected WeatherBeatenJournal/WeatherBeatenJournal.toc not found" && exit 1)
      
      - name: Build test zip (no publish)
        run: |
          mkdir -p dist
          zip -r "dist/WeatherBeatenJournal-test.zip" "WeatherBeatenJournal" \
            -x "*.psd" "*.xcf" "*.blend" \
            -x "*.kra" "*.aseprite" \
            -x "*.zip" "*.7z" "*.rar" \
            -x "**/.DS_Store" "**/Thumbs.db"

      - name: Verify zip structure
        run: |
          unzip -l dist/WeatherBeatenJournal-test.zip | grep -q "^ *.* WeatherBeatenJournal/WeatherBeatenJournal.toc$" \
            || (echo "Zip missing WeatherBeatenJournal/WeatherBeatenJournal.toc" && exit 1)
